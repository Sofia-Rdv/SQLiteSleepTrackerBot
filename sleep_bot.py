import os
import telebot
import logging
from telebot import types
from datetime import datetime
# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º DatabaseManager, –≤ –Ω–µ–º –≤—Å—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –ë–î
from database_manager import DatabaseManager
# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑ —Ñ–∞–π–ª–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
from my_logger_config import setup_logging
# –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–û–î–ò–ù –†–ê–ó) –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
setup_logging()

# –ü–æ–ª—É—á–µ–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –ª–æ–≥–≥–µ—Ä–∞
logger = logging.getLogger(f'my_app.{__name__}')

# --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö ---
# –¢–æ–∫–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
MY_TOKEN_BOT = os.getenv("API_TOKEN")
bot = telebot.TeleBot(MY_TOKEN_BOT)
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
db = DatabaseManager()


# --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ ---
@bot.message_handler(commands=['start'])
def send_welcome(message: types.Message):
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É start.
    –°–æ–∑–¥–∞–µ—Ç inline –∏ Reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Å callback_data - –∫–æ–º–∞–Ω–¥–∞–º–∏ –∏ –æ–±—ã—á–Ω—ã–º–∏.
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–æ–º, –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º.
    :param message: types.Message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.
    """
    logger.info('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–∑–≤–∞–ª –∫–æ–º–∞–Ω–¥—É /start.')
    # ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —á–∞—Ç–∞ —Å –±–æ—Ç–æ–º –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–º–µ
    user_id = message.chat.id
    # –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ —Ç–µ–ª–µ–≥—Ä–∞–º–º–∞
    user_name = message.from_user.first_name if message.from_user.first_name else '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
    # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    db.add_user(user_id, user_name)

    # —Å–æ–∑–¥–∞–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    markup = types.InlineKeyboardMarkup()
    # —Å–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ —Å callback_data - –∫–æ–º–∞–Ω–¥–∞–º–∏
    sleep_button = types.InlineKeyboardButton("–°–ª–∞–¥–∫–∏—Ö —Å–Ω–æ–≤ üò¥", callback_data='/sleep')
    wake_button = types.InlineKeyboardButton("–Ø –ø—Ä–æ—Å–Ω—É–ª—Å—è ‚òÄ", callback_data='/wake')
    quality_button = types.InlineKeyboardButton("–ö–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞ üí´", callback_data='/quality')
    notes_button = types.InlineKeyboardButton("–ó–∞–º–µ—Ç–∫–∏ üìù", callback_data='/notes')
    recom_button = types.InlineKeyboardButton("–û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ üßòüèº‚Äç‚ôÄÔ∏è", callback_data='/recom')
    statis_inl_button = types.InlineKeyboardButton("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–Ω–∞ üìäüí§", callback_data='/statis')
    # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    markup.add(sleep_button, wake_button)
    markup.add(quality_button, notes_button)
    markup.add(recom_button)
    markup.add(statis_inl_button)

    # —Å–æ–∑–¥–∞–µ–º Reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    # —Å–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏
    start_button = types.KeyboardButton("/start")
    help_button = types.KeyboardButton("/help")
    recom_button_reply = types.KeyboardButton("/recom")
    statis_button = types.KeyboardButton("/statis")
    # –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    keyboard.add(help_button, recom_button_reply)
    keyboard.add(start_button, statis_button)

    bot.send_message(message.chat.id, """–ü—Ä–∏–≤–µ—Ç!
    –Ø –±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ –∫–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞üí§.
    –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –∏–ª–∏ –∫–æ–º–∞–Ω–¥—ã:
    /sleep - –Ω–∞—á–∞–ª–æ —Å–Ω–∞. –í—ã–±–∏—Ä–∞–π—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É, –∫–æ–≥–¥–∞ –ª–æ–∂–∏—Ç–µ—Å—å —Å–ø–∞—Ç—å!(–∏–ª–∏ –∫–Ω–æ–ø–∫–∞ '–°–ª–∞–¥–∫–∏—Ö —Å–Ω–æ–≤ üò¥')
    /wake - –∫–æ–Ω–µ—Ü —Å–Ω–∞. –í—ã–±–∏—Ä–∞–π—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É, –∫–æ–≥–¥–∞ –ø—Ä–æ—Å–Ω—É–ª–∏—Å—å!(–∏–ª–∏ –∫–Ω–æ–ø–∫–∞ '–Ø –ø—Ä–æ—Å–Ω—É–ª—Å—è ‚òÄ')
    /quality - –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞ –ø–æ 5-–±–∞–ª—å–Ω–æ–π —à–∫–∞–ª–µ. –í—ã–±–∏—Ä–∞–π—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É, –∫–æ–≥–¥–∞ —Ö–æ—Ç–∏—Ç–µ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É –∫–∞—á–µ—Å—Ç–≤–∞ —Å–≤–æ–µ–º—É —Å–Ω—É!(–∏–ª–∏ –∫–Ω–æ–ø–∫–∞ '–ö–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞ üí´')
    /notes - –í–∞—à –¥–Ω–µ–≤–Ω–∏–∫ –¥–ª—è –∑–∞–º–µ—Ç–æ–∫. –í—ã–±–∏—Ä–∞–π—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É, –∫–æ–≥–¥–∞ —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –æ—Ü–µ–Ω–∫–µ –∫–∞—á–µ—Å—Ç–≤–∞ –í–∞—à–µ–≥–æ —Å–Ω–∞!(–∏–ª–∏ –∫–Ω–æ–ø–∫–∞ '–ó–∞–º–µ—Ç–∫–∏ üìù')
    /recom - –æ–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞ (–∏–ª–∏ –∫–Ω–æ–ø–∫–∞ '–û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ üßòüèº‚Äç‚ôÄÔ∏è')
    /statis - c—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –í–∞—à–µ–≥–æ —Å–Ω–∞. –í—ã–±–∏—Ä–∞–π—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É, –∫–æ–≥–¥–∞ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –í–∞—à–µ–≥–æ —Å–Ω–∞, –≤ –Ω–µ–µ –≤—Ö–æ–¥—è—Ç:
    –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π —Å–Ω–∞, –æ–±—â–∞—è –∏ —Å—Ä–µ–¥–Ω—è—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–Ω–∞ (–∏–ª–∏ –∫–Ω–æ–ø–∫–∞ '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–Ω–∞ üìäüí§')
    /help - –ø—Ä–∏—à–ª—é —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
    /start - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞""", reply_markup=markup)
    logger.debug('–û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π.')
    bot.send_message(message.chat.id, """–ö–Ω–æ–ø–∫–∏ —Å —ç—Ç–∏–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏ –±—É–¥—É—Ç –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω—ã:
    /help - –ø—Ä–∏—à–ª—é —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
    /recom - –æ–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞
    /statis - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–Ω–∞
    /start - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
    –û–Ω–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –ø–æ–¥ —Å—Ç—Ä–æ–∫–æ–π –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è, –∏–ª–∏ —Ä—è–¥–æ–º —Å–æ –∑–Ω–∞—á–∫–æ–º –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞""", reply_markup=keyboard)
    logger.debug('–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–æ–º–∞–Ω–¥–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω—ã.')


@bot.message_handler(commands=['help'])
def handle_help(message: types.Message):
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É help.
    –°–æ–∑–¥–∞–µ—Ç inline –∏ Reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Å callback_data - –∫–æ–º–∞–Ω–¥–∞–º–∏ –∏ –æ–±—ã—á–Ω—ã–º–∏.
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏ –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π.
    :param message: types.Message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.
    """
    logger.info('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–∑–≤–∞–ª –∫–æ–º–∞–Ω–¥—É /help.')
    # —Å–æ–∑–¥–∞–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    markup = types.InlineKeyboardMarkup()
    # —Å–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ —Å callback_data - –∫–æ–º–∞–Ω–¥–∞–º–∏
    sleep_button = types.InlineKeyboardButton("–°–ª–∞–¥–∫–∏—Ö —Å–Ω–æ–≤ üò¥", callback_data='/sleep')
    wake_button = types.InlineKeyboardButton("–Ø –ø—Ä–æ—Å–Ω—É–ª—Å—è ‚òÄ", callback_data='/wake')
    quality_button = types.InlineKeyboardButton("–ö–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞ üí´", callback_data='/quality')
    notes_button = types.InlineKeyboardButton("–ó–∞–º–µ—Ç–∫–∏ üìù", callback_data='/notes')
    recom_button = types.InlineKeyboardButton("–û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ üßòüèº‚Äç‚ôÄÔ∏è", callback_data='/recom')
    statis_inl_button = types.InlineKeyboardButton("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–Ω–∞ üìäüí§", callback_data='/statis')
    # –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    markup.add(sleep_button, wake_button)
    markup.add(quality_button, notes_button)
    markup.add(recom_button)
    markup.add(statis_inl_button)

    bot.send_message(message.chat.id, """–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥:
    /sleep - –Ω–∞—á–∞–ª–æ —Å–Ω–∞. –í—ã–±–∏—Ä–∞–π—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É, –∫–æ–≥–¥–∞ –ª–æ–∂–∏—Ç–µ—Å—å —Å–ø–∞—Ç—å!(–∏–ª–∏ –∫–Ω–æ–ø–∫–∞ '–°–ª–∞–¥–∫–∏—Ö —Å–Ω–æ–≤ üò¥')
    /wake - –∫–æ–Ω–µ—Ü —Å–Ω–∞. –í—ã–±–∏—Ä–∞–π—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É, –∫–æ–≥–¥–∞ –ø—Ä–æ—Å–Ω—É–ª–∏—Å—å!(–∏–ª–∏ –∫–Ω–æ–ø–∫–∞ '–Ø –ø—Ä–æ—Å–Ω—É–ª—Å—è ‚òÄ')
    /quality - –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞ –ø–æ 5-–±–∞–ª—å–Ω–æ–π —à–∫–∞–ª–µ. –í—ã–±–∏—Ä–∞–π—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É, –∫–æ–≥–¥–∞ —Ö–æ—Ç–∏—Ç–µ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É –∫–∞—á–µ—Å—Ç–≤–∞ —Å–≤–æ–µ–º—É —Å–Ω—É!(–∏–ª–∏ –∫–Ω–æ–ø–∫–∞ '–ö–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞ üí´')
    /notes - –í–∞—à –¥–Ω–µ–≤–Ω–∏–∫ –¥–ª—è –∑–∞–º–µ—Ç–æ–∫. –í—ã–±–∏—Ä–∞–π—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É, –∫–æ–≥–¥–∞ —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –æ—Ü–µ–Ω–∫–µ –∫–∞—á–µ—Å—Ç–≤–∞ –í–∞—à–µ–≥–æ —Å–Ω–∞!(–∏–ª–∏ –∫–Ω–æ–ø–∫–∞ '–ó–∞–º–µ—Ç–∫–∏ üìù')
    /recom - –æ–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞ (–∏–ª–∏ –∫–Ω–æ–ø–∫–∞ '–û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ üßòüèº‚Äç‚ôÄÔ∏è')
    /statis - c—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –í–∞—à–µ–≥–æ —Å–Ω–∞. –í—ã–±–∏—Ä–∞–π—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É, –∫–æ–≥–¥–∞ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –í–∞—à–µ–≥–æ —Å–Ω–∞, –≤ –Ω–µ–µ –≤—Ö–æ–¥—è—Ç:
    –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π —Å–Ω–∞, –æ–±—â–∞—è –∏ —Å—Ä–µ–¥–Ω—è—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–Ω–∞ (–∏–ª–∏ –∫–Ω–æ–ø–∫–∞ '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–Ω–∞ üìäüí§')
    /help - –ø—Ä–∏—à–ª—é —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ üìÉ
    /start - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ üîÅ
    –í–∞–∂–Ω–æ! –ü–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –Ω–µ–π –í—ã –º–æ–∂–µ—Ç–µ —Ç–æ–ª—å–∫–æ –≤ –¥–µ–Ω—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ —Å–Ω–∞üí´
    –¢–∞–∫–∂–µ –í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ :""", reply_markup=markup)
    logger.debug('–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ —Å–ø–∏—Å–∫–æ–º –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥.')


@bot.message_handler(commands=['recom'])
def handle_recom(message: types.Message):
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É recom. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –æ–±—â–∏–º–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏.
    :param message: types.Message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.
    """
    logger.info('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–∑–≤–∞–ª –∫–æ–º–∞–Ω–¥—É /recom.')
    bot.send_message(message.chat.id, """‚ú®–û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞:

1. –°—Ç–∞—Ä–∞–π—Ç–µ—Å—å –ª–æ–∂–∏—Ç—å—Å—è —Å–ø–∞—Ç—å –¥–æ 22:00 üåå

2. –°–ø–∏—Ç–µ –Ω–µ –º–µ–Ω–µ–µ 8 —á–∞—Å–æ–≤ –≤ –¥–µ–Ω—å ‚è∞

3. –î–æ–±–∞–≤–ª—è–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –¥–Ω–µ–≤–Ω–æ–π —Å–æ–Ω,
–µ—Å–ª–∏ –ø–ª–æ—Ö–æ –∏–ª–∏ –º–∞–ª–æ —Å–ø–∞–ª–∏ –Ω–æ—á—å—é üõå

4. –ù–µ –∫—É—à–∞–π—Ç–µ —Ç—è–∂–µ–ª—É—é –ø–∏—â—É –ø–µ—Ä–µ–¥ —Å–Ω–æ–º –∏ –≤ —Ü–µ–ª–æ–º –Ω–µ —Å—Ç–æ–∏—Ç –µ—Å—Ç—å –∑–∞ 1,5-2 —á–∞—Å–∞ –¥–æ —Å–Ω–∞ üçΩÔ∏è

5. –£–±–∏—Ä–∞–π—Ç–µ –≥–∞–¥–∂–µ—Ç—ã –∫–∞–∫ –º–∏–Ω–∏–º—É–º –∑–∞ 30 –º–∏–Ω—É—Ç –¥–æ —Å–Ω–∞ üì±üíª

6. –ü–æ–ª—å–∑—É–π—Ç–µ—Å—å –±–µ—Ä—É—à–∞–º–∏, –µ—Å–ª–∏ –í—ã —á—É—Ç–∫–æ —Å–ø–∏—Ç–µ üôâ

7. –ü–æ–ª–µ–∑–Ω–æ –ø–∏—Ç—å —á–∞–π —Å –º–µ–ª–∏—Å—Å–æ–π, –æ–Ω –æ–±–ª–∞–¥–∞–µ—Ç –º—è–≥–∫–∏–º —É—Å–ø–æ–∫–∞–∏–≤–∞—é—â–∏–º –∏ —Ä–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–º —ç—Ñ—Ñ–µ–∫—Ç–æ–º üçµ""")
    logger.debug('–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏.')


def calculate_sleep_statistics(user_id: int) -> str:
    """
    –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–Ω–∞ –≤ —á–∞—Å—ã –∏ –º–∏–Ω—É—Ç—ã.
    :param user_id: int: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–º–µ.
    :return: str: –¢–µ–∫—Å—Ç —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π —Å–Ω–∞ –∏–ª–∏ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –æ —Ç–æ–º, —á—Ç–æ –¥–∞–Ω–Ω—ã—Ö –æ —Å–Ω–µ –Ω–µ—Ç.
    """
    try:
        total_session, total_sleep_duration_sec, average_sleep_duration_sec = db.get_sleep_statistic(user_id)
        # –ü—Ä–æ–≤–µ—Ä–∫–∞, –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–∞–Ω–Ω—ã–µ –æ —Å–Ω–µ
        if total_session == 0:
            logger.info('–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å–Ω–µ.')
            return "–£ –í–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å–Ω–µ.üôÉ"

        # –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —á–∞—Å—ã –∏ –º–∏–Ω—É—Ç—ã
        total_hours = int(total_sleep_duration_sec // 3600)
        total_minutes = int((total_sleep_duration_sec % 3600) // 60)
        average_hours = int(average_sleep_duration_sec // 3600)
        average_minutes = int((average_sleep_duration_sec % 3600) // 60)

        # —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        statistics_text = f"""üí§üìä–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–Ω–∞:

    üò¥–í—Å–µ–≥–æ —Å–µ—Å—Å–∏–π —Å–Ω–∞: {total_session}

    ‚è≥–û–±—â–∞—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–Ω–∞: {total_hours} —á–∞—Å–æ–≤ {total_minutes} –º–∏–Ω—É—Ç

    üõå–°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–Ω–∞: {average_hours} —á–∞—Å–æ–≤ {average_minutes} –º–∏–Ω—É—Ç"""
        logger.debug('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–Ω–∞ –ø–æ–ª—É—á–µ–Ω–∞ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∞ –≤ –º–∏–Ω—É—Ç—ã –∏ —á–∞—Å—ã.')
        return statistics_text
    except Exception as e:
        logger.error(f'–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–Ω–∞ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏ –≤ –º–∏–Ω—É—Ç—ã –∏ —á–∞—Å—ã: {e}', exc_info=True)
        return f"–ü—Ä–æ—Å—Ç–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ {e}. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.üòî"


@bot.message_handler(commands=['statis'])
def handle_statistics(message: types.Message):
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É statis.
    –í—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–Ω–∞ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
    :param message: types.Message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.
    """
    logger.info('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–∑–≤–∞–ª –∫–æ–º–∞–Ω–¥—É /statis.')
    user_id = message.chat.id
    statistics = calculate_sleep_statistics(user_id)
    logger.debug(f'–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π —Å–Ω–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ({user_id})')
    bot.send_message(user_id, statistics)


@bot.message_handler(commands=['sleep'])
def handle_sleep(message: types.Message):
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É sleep.
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π(–Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π) —Å–µ—Å—Å–∏–∏ —Å–Ω–∞ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è,
    –∏–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç, –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é —Å–Ω–∞.
    –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏ —Å–Ω–∞ –Ω–µ—Ç, –Ω–∞—á–∏–Ω–∞–µ—Ç –Ω–æ–≤—É—é.
    :param message: types.Message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.
    """
    logger.info('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–∑–≤–∞–ª –∫–æ–º–∞–Ω–¥—É /sleep.')
    user_id = message.chat.id
    user_name = message.from_user.first_name if message.from_user.first_name else '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
    # –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—Å—Ç—å –≤ –ë–î
    db.add_user(user_id, user_name)

    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏ —Å–Ω–∞
        sleep_record_id, sleep_start_time = db.get_latest_unfinished_sleep_session(user_id)
        if sleep_record_id:
            markup = types.InlineKeyboardMarkup()
            wake_button = types.InlineKeyboardButton("–Ø –ø—Ä–æ—Å–Ω—É–ª—Å—è ‚òÄ", callback_data='/wake')
            markup.add(wake_button)
            bot.send_message(user_id, "–£ –í–∞—Å —É–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è —Å–Ω–∞üò¥\n"
                                      "–°–Ω–∞—á–∞–ª–∞ –∑–∞–≤–µ—Ä—à–∏—Ç–µ –µ–µ –æ—Ç–º–µ—Ç–∏–≤ —Å–≤–æ–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ.üòä", reply_markup=markup)
            logger.debug('–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é —Å–Ω–∞.')
            logger.info(f'–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ({user_id}) —É–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è —Å–Ω–∞, –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É /sleep –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ.')
            return

        # –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞, –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—á–∞–ª–∞ —Å–µ—Å—Å–∏–∏ —Å–Ω–∞
        current_time = datetime.now()
        new_sleep_record_id = db.start_sleep_session(user_id, current_time)
        if new_sleep_record_id:
            markup = types.InlineKeyboardMarkup()
            wake_button = types.InlineKeyboardButton("–Ø –ø—Ä–æ—Å–Ω—É–ª—Å—è ‚òÄ", callback_data='/wake')
            markup.add(wake_button)
            bot.send_message(user_id, "–û—Ç–º–µ—á–µ–Ω–æ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Å–Ω–∞.\n–°–ª–∞–¥–∫–∏—Ö —Å–Ω–æ–≤!‚ú®\n–ù–µ –∑–∞–±—É–¥—å—Ç–µ –æ—Ç–º–µ—Ç–∏—Ç—å —Å–≤–æ–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ!")
            logger.debug('–û—Ç–º–µ—á–µ–Ω–æ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Å–Ω–∞.')
            bot.send_message(user_id, "–û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ: ", reply_markup=markup)
            logger.debug('–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è.')
        else:
            bot.send_message(user_id, "–ü—Ä–æ—Å—Ç–∏—Ç–µ, –Ω–µ —É–¥–∞–ª–æ—Å—å –Ω–∞—á–∞—Ç—å —Å–µ—Å—Å–∏—é —Å–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.üòî")
            logger.warning('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é —Å–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.')

    except Exception as e:
        bot.send_message(user_id, f"–ü—Ä–æ—Å—Ç–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ {e}. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.üòî")
        logger.error(f'–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã /sleep: {e}', exc_info=True)


@bot.message_handler(commands=['wake'])
def handle_wake(message: types.Message):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã wake.
    –ò—â–µ—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—É—é —Å–µ—Å—Å–∏—é —Å–Ω–∞, –∏–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç, –µ—Å–ª–∏ –Ω–µ—Ç —Ç–∞–∫–æ–π –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–º–µ—Ç–∏—Ç—å –Ω–∞—á–∞–ª–æ —Å–Ω–∞.
    –ï—Å–ª–∏ —Å–µ—Å—Å–∏—è –Ω–∞–π–¥–µ–Ω–∞, –∑–∞–≤–µ—Ä—à–∞–µ—Ç –µ–µ –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–Ω–∞ –∑–∞ —ç—Ç—É —Å–µ—Å—Å–∏—é.
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é —Å–Ω–∞ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –æ—Ü–µ–Ω–∏—Ç—å –µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–æ.
    :param message: types.Message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.
    """
    logger.info('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–∑–≤–∞–ª –∫–æ–º–∞–Ω–¥—É /wake.')
    user_id = message.chat.id
    user_name = message.from_user.first_name if message.from_user.first_name else '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
    db.add_user(user_id, user_name)
    try:
        # –ò—â–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—É—é —Å–µ—Å—Å–∏—é —Å–Ω–∞
        sleep_record_id, sleep_start_time = db.get_latest_unfinished_sleep_session(user_id)
        if sleep_record_id:
            sleep_end_time = datetime.now()
            # –ó–∞–≤–µ—Ä—à–∞–µ–º –Ω–∞–π–¥–µ–Ω–Ω—É—é —Å–µ—Å—Å–∏—é —Å–Ω–∞
            db.end_sleep_session(sleep_record_id, sleep_end_time)

            # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–Ω–∞ –∑–∞ —ç—Ç—É —Å–µ—Å—Å–∏—é
            duration = sleep_end_time - sleep_start_time
            duration_hours = int(duration.total_seconds() // 3600)
            duration_minutes = int((duration.total_seconds() % 3600) // 60)

            markup_q = types.InlineKeyboardMarkup()
            quality_button = types.InlineKeyboardButton("–ö–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞ üí´", callback_data='/quality')
            markup_q.add(quality_button)
            bot.send_message(user_id,
                             f"–ù–∞–¥–µ—é—Å—å –í—ã –≤—ã—Å–ø–∞–ª–∏—Å—å!‚òÄ –í—ã —Å–ø–∞–ª–∏, –ø—Ä–∏–º–µ—Ä–Ω–æ, {duration_hours} —á–∞—Å–æ–≤ {duration_minutes} –º–∏–Ω—É—Ç.\n"
                             f"–ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É –í–∞—à–µ–º—É —Å–Ω—É —Å–µ–≥–æ–¥–Ω—è!üòå")
            logger.debug('–û—Ç–ø—Ä–∞–≤–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é —Å–Ω–∞ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –æ—Ü–µ–Ω–∏—Ç—å –µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–æ.')
            bot.send_message(user_id, "–ü–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É: ", reply_markup=markup_q)
            logger.debug('–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞.')
        else:
            markup_s = types.InlineKeyboardMarkup()
            sleep_button = types.InlineKeyboardButton("–°–ª–∞–¥–∫–∏—Ö —Å–Ω–æ–≤ üò¥", callback_data='/sleep')
            markup_s.add(sleep_button)
            bot.send_message(user_id, "–°–Ω–∞—á–∞–ª–∞ –æ—Ç–º–µ—Ç—å—Ç–µ, –∫–æ–≥–¥–∞ –ª–µ–≥–ª–∏ —Å–ø–∞—Ç—å.üòä", reply_markup=markup_s)
            logger.debug('–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è, —Å –∫–Ω–æ–ø–∫–æ–π, –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–º–µ—Ç–∏—Ç—å –Ω–∞—á–∞–ª–æ —Å–Ω–∞.')
            logger.info(f'–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ({user_id}) –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏ —Å–Ω–∞, –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É /wake –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ.')

    except Exception as e:
        bot.send_message(user_id, f"–ü—Ä–æ—Å—Ç–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ {e}. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.üòî")
        logger.error(f'–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã /wake: {e}', exc_info=True)


@bot.message_handler(commands=['quality'])
def handle_quality(message: types.Message):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã quality.
    –ò—â–µ—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—É—é —Å–µ—Å—Å–∏—é –±–µ–∑ –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞,
    –∏–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç, –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–º–µ—Ç–∏—Ç—å —Å–≤–æ–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ –∏–ª–∏ –æ—Ü–µ–Ω–∫–∞ —É–∂–µ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∞.
    –°–æ–∑–¥–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –∏ –∫–Ω–æ–ø–∫–∏ —Å –æ—Ü–µ–Ω–∫–∞–º–∏ –æ—Ç 1 –¥–æ 5, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–º–µ—Å—Ç–µ —Å –∫—Ä–∞—Ç–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ—Ü–µ–Ω–∫–∞—Ö.
    :param message: types.Message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.
    """
    logger.info('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–∑–≤–∞–ª –∫–æ–º–∞–Ω–¥—É /quality.')
    user_id = message.chat.id
    user_name = message.from_user.first_name if message.from_user.first_name else '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
    db.add_user(user_id, user_name)
    try:
        # –ò—â–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—É—é —Å–µ—Å—Å–∏—é —Å–µ–≥–æ–¥–Ω—è –±–µ–∑ –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞
        today = datetime.now().date()
        sleep_record_id, _, _ = db.get_latest_finished_sleep_session_without_quality(user_id, date=today)
        if sleep_record_id:
            # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –∏ –∫–Ω–æ–ø–∫–∏ —Å –æ—Ü–µ–Ω–∫–∞–º–∏ –æ—Ç 1 –¥–æ 5
            keyboard = types.InlineKeyboardMarkup()
            for i in range(1, 6):
                button = types.InlineKeyboardButton(str(i), callback_data=f'quality_{i}_{sleep_record_id}')
                keyboard.add(button)
            bot.send_message(user_id, """–û—Ü–µ–Ω–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫–∞—á–µ—Å—Ç–≤–æ –í–∞—à–µ–≥–æ —Å–Ω–∞ —Å–µ–≥–æ–¥–Ω—è!

            –û—Ü–µ–Ω–∫–∞ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–Ω–∞ –≤ —Ç–æ—á–Ω–æ—Å—Ç–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏—é.
            –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —á—Ç–æ–±—ã –æ–Ω–∞ –ø–æ–¥—Ö–æ–¥–∏–ª–∞ –ª—É—á—à–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö, –∞ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –æ—Ç–ª–∏—á–∏—è —É–∫–∞–∂–∏—Ç–µ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –æ—Ü–µ–Ω–∫–µ.

            1Ô∏è‚É£ –û—á–µ–Ω—å –ø–ª–æ—Ö–æ —Å–ø–∞–ª–æ—Å—å, —Ö—É–∂–µ –Ω–µ–∫—É–¥–∞. –ß—É–≤—Å—Ç–≤—É—é —Å–µ–±—è –ø–æ–¥–∞–≤–ª–µ–Ω–Ω–æ –∏ —Ä–∞–∑–±–∏—Ç–æ...

            2Ô∏è‚É£ –°–ø–∞–ª–æ—Å—å –ø–ª–æ—Ö–æ,–æ—á–µ–Ω—å —á—É—Ç–∫–æ. –•–æ—á–µ—Ç—Å—è –ø–æ—Å–∫–æ—Ä–µ–µ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫—Ä–æ–≤–∞—Ç–∫—É.

            3Ô∏è‚É£ –î–æ–ª–≥–æ –Ω–µ –ø–æ–ª—É—á–∞–ª–æ—Å—å —É—Å–Ω—É—Ç—å, –Ω–æ –≤ —Ü–µ–ª–æ–º —Å–ø–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ.

            4Ô∏è‚É£ –°–ø–∞–ª–æ—Å—å —Ö–æ—Ä–æ—à–æ, –Ω–æ –Ω–µ –ø—Ä–æ—Ç–∏–≤ –µ—â–µ –ø–æ–≤–∞–ª—è—Ç—å—Å—è –≤ –∫—Ä–æ–≤–∞—Ç–∫–µ.

            5Ô∏è‚É£ –°–ø–∞–ª–æ—Å—å –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ, —É–¥–∞–ª–æ—Å—å –≤—ã—Å–ø–∞—Ç—å—Å—è, —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è –æ—Ç–ª–∏—á–Ω–æ!""", reply_markup=keyboard)
            logger.debug('–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞.')
        else:
            markup = types.InlineKeyboardMarkup()
            wake_button = types.InlineKeyboardButton("–Ø –ø—Ä–æ—Å–Ω—É–ª—Å—è ‚òÄ", callback_data='/wake')
            markup.add(wake_button)
            bot.send_message(user_id, "–°–Ω–∞—á–∞–ª–∞ –æ—Ç–º–µ—Ç—å—Ç–µ —Å–≤–æ–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ,"
                                      " –∏–ª–∏ –í—ã —É–∂–µ –æ—Ü–µ–Ω–∏–ª–∏ —Å–≤–æ–π –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–æ–Ω.üòä", reply_markup=markup)
            logger.debug('–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è, —Å –∫–Ω–æ–ø–∫–æ–π, –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç–º–µ—Ç–∏—Ç—å —Å–≤–æ–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ –∏–ª–∏ –æ—Ü–µ–Ω–∫–∞ —É–∂–µ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∞.')
            logger.info(f'–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ({user_id}) –Ω–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏ —Å–Ω–∞ –±–µ–∑ –æ—Ü–µ–Ω–∫–∏,'
                        f' –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É /quality –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ.')
    except Exception as e:
        bot.send_message(user_id, f"–ü—Ä–æ—Å—Ç–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ {e}. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.üòî")
        logger.error(f'–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã /quality: {e}', exc_info=True)


@bot.callback_query_handler(func=lambda call: call.data.startswith("quality_"))
def handle_quality_callback(call: types.CallbackQuery):
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞.
    –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∏–∑ callback_data –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ (–æ—Ü–µ–Ω–∫–∞, ID —Å–µ—Å—Å–∏–∏), –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–¥–µ–ª–∏–≤ –Ω–∞ —á–∞—Å—Ç–∏.
    –î–æ–±–∞–≤–ª—è–µ—Ç –æ—Ü–µ–Ω–∫—É –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞, –¥–ª—è –Ω–∞–π–¥–µ–Ω–Ω–æ–π —Ä–∞–Ω–µ–µ —Å–µ—Å—Å–∏–∏, –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.
    :param call: types.CallbackQuery: –û–±—ä–µ–∫—Ç CallbackQuery, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –¥–∞–Ω–Ω—ã–µ –æ –Ω–∞–∂–∞—Ç–æ–π inline - –∫–Ω–æ–ø–∫–µ.
    """
    logger.info('–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–∏ –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞.')
    user_id = call.from_user.id
    try:
        parts = call.data.split('_')
        # –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞
        quality = int(parts[1])
        # ID —Å–µ—Å—Å–∏–∏ —Å–Ω–∞, –∫–æ—Ç–æ—Ä–æ–π –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –æ—Ü–µ–Ω–∫—É
        sleep_record_id = int(parts[2])

        # –î–æ–±–∞–≤–ª—è–µ–º –æ—Ü–µ–Ω–∫—É –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
        db.update_sleep_quality(sleep_record_id, quality)

        markup = types.InlineKeyboardMarkup()
        notes_button = types.InlineKeyboardButton("–ó–∞–º–µ—Ç–∫–∏ üìù", callback_data='/notes')
        markup.add(notes_button)
        # –∏–∑–º–µ–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ, —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞,
        # –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –Ω–∞ –∫–∞–∫—É—é-—Ç–æ –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫, –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –Ω–∏–∂–µ
        bot.edit_message_text(chat_id=user_id, message_id=call.message.message_id,
                              text=f"–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞ {quality} –∑–∞–ø–∏—Å–∞–Ω–∞! –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –æ—Ü–µ–Ω–∫–µ"
                                   f" –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã /notes –∏–ª–∏ –∫–Ω–æ–ø–∫–∏ :", reply_markup=markup)
        logger.debug('–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è, —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞, –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É.')

    except Exception as e:
        bot.send_message(call.message.chat.id, f"–ü—Ä–æ—Å—Ç–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ {e}. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.üòî")
        logger.error(f'–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–∏ –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞: {e}', exc_info=True)

    # –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç–æ–≥–æ, —á—Ç–æ –∑–∞–ø—Ä–æ—Å –±—ã–ª –ø–æ–ª—É—á–µ–Ω –∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
    bot.answer_callback_query(call.id)


@bot.message_handler(commands=['notes'])
def handle_notes(message: types.Message):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã notes. –ü–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –∑–∞–º–µ—Ç–∫–∏ –∫ —Å–µ—Å—Å–∏—è–º —Å–Ω–∞.
    –ò—â–µ—Ç —Å–µ—Å—Å–∏—é —Å –æ—Ü–µ–Ω–∫–æ–π –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞, –∏–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç, –µ—Å–ª–∏ —Ç–∞–∫–æ–π –Ω–µ—Ç –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–Ω–∞—á–∞–ª–∞ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É.
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –µ—Å—Ç—å –ª–∏ —É–∂–µ –∑–∞–º–µ—Ç–∫–∞ –∫ –Ω–∞–π–¥–µ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏ —Å–Ω–∞, –∏–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç, –µ—Å–ª–∏ –∑–∞–º–µ—Ç–∫–∞ —É–∫–∞–∑–Ω–∞ –∏ –µ–µ –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å.
    :param message: types.Message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.
    """
    logger.info('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–∑–≤–∞–ª –∫–æ–º–∞–Ω–¥—É /notes.')
    user_id = message.chat.id
    user_name = message.from_user.first_name if message.from_user.first_name else '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
    db.add_user(user_id, user_name)

    try:
        today = datetime.now().date()
        # –ò—â–µ–º —Å–µ—Å—Å–∏—é —Å –æ—Ü–µ–Ω–∫–æ–π –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞
        sleep_record_data = db.get_latest_finished_sleep_session_with_quality(user_id, date=today)
        if sleep_record_data:
            sleep_record_id, _, _ = sleep_record_data

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∑–∞–º–µ—Ç–∫–∏ –∫ –Ω–∞–π–¥–µ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏ —Å–Ω–∞
            existing_note = db.get_note_by_sleep_record_id(sleep_record_id)
            if existing_note:
                markup_n = types.InlineKeyboardMarkup()
                button_yes = types.InlineKeyboardButton('–î–∞, –æ–±–Ω–æ–≤–∏', callback_data=f'update_yes_{sleep_record_id}')
                button_no = types.InlineKeyboardButton('–ù–µ—Ç', callback_data=f'update_no_{sleep_record_id}')
                markup_n.add(button_yes, button_no)
                bot.send_message(user_id, f'–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∑–∞–º–µ—Ç–∫–∞ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—Ü–µ–Ω–µ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏ —Å–Ω–∞: "{existing_note}".'
                                          f'–•–æ—Ç–∏—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â—É—é –∑–∞–º–µ—Ç–∫—É?', reply_markup=markup_n)
                logger.debug('–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è, —Å –∫–Ω–æ–ø–∫–∞–º–∏, —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –æ–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â—É—é –∑–∞–º–µ—Ç–∫—É.')
                logger.info(f'–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ({user_id}) —É–∂–µ –µ—Å—Ç—å –∑–∞–º–µ—Ç–∫–∞ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—Ü–µ–Ω–µ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏ —Å–Ω–∞.')
            else:
                bot.send_message(user_id, "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –í–∞—à–µ–π –æ—Ü–µ–Ω–∫–µ —Å–Ω–∞ "
                                          "—Ç–µ–∫—Å—Ç–æ–º –≤ –æ–¥–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏, —è –≤—Å–µ –∑–∞–ø–∏—Å—ã–≤–∞—é!"
                                          "\n–î–ª—è –æ—Ç–º–µ–Ω—ã –Ω–∞–ø–∏—à–∏—Ç–µ /cancel –∏–ª–∏ /stop, –ø—Ä–æ—Å—Ç–æ '–û—Ç–º–µ–Ω–∞' —Ç–æ–∂–µ –ø–æ–¥–æ–π–¥–µ—Ç.üòä")
                logger.debug('–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø—Ä–æ—Å—å–±–æ–π –Ω–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –æ—Ü–µ–Ω–∫–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞.')
                logger.info(f'–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ({user_id}) –∑–∞–º–µ—Ç–∫–∏ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—Ü–µ–Ω–µ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏ —Å–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.')
                # –∑–∞–¥–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ –±–æ—Ç–∞, –∞ –∏–º–µ–Ω–Ω–æ,
                # –≤—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∑–∞–ø–∏—Å–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ –æ—Ü–µ–Ω–∫–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞ –∏ –ø–µ—Ä–µ–¥–∞–µ–º sleep_record_id
                bot.register_next_step_handler(message, process_notes_step, sleep_record_id)
        else:
            markup = types.InlineKeyboardMarkup()
            quality_button = types.InlineKeyboardButton("–ö–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞ üí´", callback_data='/quality')
            markup.add(quality_button)
            bot.send_message(user_id, "–£ –í–∞—Å –Ω–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏ —Å–Ω–∞ —Å –æ—Ü–µ–Ω–∫–æ–π –∫–∞—á–µ—Å—Ç–≤–∞, "
                                      "–∫ –∫–æ—Ç–æ—Ä–æ–π –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É. "
                                      "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –æ—Ü–µ–Ω–∏—Ç–µ —Å–æ–Ω.üòä", reply_markup=markup)
            logger.debug('–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è, —Å –∫–Ω–æ–ø–∫–æ–π, –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ü–µ–Ω–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞.')
            logger.info(f'–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ({user_id}) –Ω–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏ —Å–Ω–∞ —Å –æ—Ü–µ–Ω–∫–æ–π –∫–∞—á–µ—Å—Ç–≤–∞,'
                        f' –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É /notes –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ. ')
    except Exception as e:
        bot.send_message(user_id, f"–ü—Ä–æ—Å—Ç–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ {e}. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.üòî")
        logger.error(f'–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã /notes: {e}', exc_info=True)


@bot.callback_query_handler(func=lambda call: call.data.startswith("update_"))
def handle_notes_update_callback(call: types.CallbackQuery):
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ –∫–Ω–æ–ø–∫–∏ —Å–æ–≥–ª–∞—Å–∏—è –∏–ª–∏ –æ—Ç–∫–∞–∑–∞ –≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–µ–∫—É—â–µ–π –∑–∞–º–µ—Ç–∫–∏ –∫ –æ—Ü–µ–Ω–∫–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞.
    :param call: types.CallbackQuery: –û–±—ä–µ–∫—Ç CallbackQuery, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –¥–∞–Ω–Ω—ã–µ –æ –Ω–∞–∂–∞—Ç–æ–π inline - –∫–Ω–æ–ø–∫–µ.
    """
    logger.info('–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–∏ —Å–æ–≥–ª–∞—Å–∏—è –∏–ª–∏ –æ—Ç–∫–∞–∑–∞ –≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–µ–∫—É—â–µ–π –∑–∞–º–µ—Ç–∫–∏ –∫ –æ—Ü–µ–Ω–∫–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞.')
    user_id = call.from_user.id
    try:
        parts = call.data.split('_')
        yes_no = parts[1]
        sleep_record_id = int(parts[2])
        if yes_no == 'yes':
            bot.edit_message_text(chat_id=user_id, message_id=call.message.message_id,
                                  text='–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ç–µ–∫—Å—Ç–æ–º, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –µ–µ. '
                                       '\n–î–ª—è –æ—Ç–º–µ–Ω—ã –Ω–∞–ø–∏—à–∏—Ç–µ /cancel –∏–ª–∏ /stop, –ø—Ä–æ—Å—Ç–æ "–û—Ç–º–µ–Ω–∞" —Ç–æ–∂–µ –ø–æ–¥–æ–π–¥–µ—Ç.üòä')
            logger.debug('–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø—Ä–æ—Å—å–±–æ–π –Ω–∞–ø–∏—Å–∞—Ç—å –Ω–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –æ—Ü–µ–Ω–∫–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞.')
            logger.info('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏.')
            bot.register_next_step_handler(call.message, process_notes_step, sleep_record_id)
        elif yes_no == 'no':
            bot.edit_message_text(chat_id=user_id, message_id=call.message.message_id,
                                  text='–•–æ—Ä–æ—à–æ, –í–∞—à–∞ –∑–∞–º–µ—Ç–∫–∞ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.üòä')
            logger.debug('–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –æ—Ç–º–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏.')
            logger.info('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–∞–∑–∞–ª—Å—è –æ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏.')
    except Exception as e:
        bot.send_message(user_id, f"–ü—Ä–æ—Å—Ç–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ {e}. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.üòî")
        logger.error(f'–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–∏ —Å–æ–≥–ª–∞—Å–∏—è –∏–ª–∏ –æ—Ç–∫–∞–∑–∞ –≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–º–µ—Ç–∫–∏: {e}', exc_info=True)

    # –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç–æ–≥–æ, —á—Ç–æ –∑–∞–ø—Ä–æ—Å –±—ã–ª –ø–æ–ª—É—á–µ–Ω –∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
    bot.answer_callback_query(call.id)


def process_notes_step(message: types.Message, sleep_record_id: int):
    """
    –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –æ—Ü–µ–Ω–∫–µ —Å–Ω–∞.
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–∏–ª –∏–º–µ–Ω–Ω–æ —Ç–µ–∫—Å—Ç.
    –ï—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å—Ç–æ–ø —Å–ª–æ–≤–æ(–∫–æ–º–∞–Ω–¥–∞) –∏–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –¥—Ä—É–≥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –∑–∞–ø–∏—Å—å –∑–∞–º–µ—Ç–∫–∏ –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è.
    :param message: types.Message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.
    :param sleep_record_id: int: ID —Å–µ—Å—Å–∏–∏ —Å–Ω–∞.
    """
    user_id = message.chat.id

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö (—Ç–µ–∫—Å—Ç, –Ω–µ –∫–æ–º–∞–Ω–¥–∞ –∏–ª–∏ —Å—Ç–æ–ø —Å–ª–æ–≤–æ)
    if not message.text:
        logger.warning(f'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id} –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–∞ –∑–∞–º–µ—Ç–∫–∏.')
        # –£–≤–µ–¥–æ–º–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        bot.send_message(user_id, '‚ö†Ô∏è–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞–º–µ—Ç–∫—É —Ç–µ–∫—Å—Ç–æ–º (–º–æ–∂–Ω–æ —Å–æ —Å–º–∞–π–ª–∏–∫–∞–º–∏). '
                                  '–°—Ç–∏–∫–µ—Ä—ã, —Ñ–æ—Ç–æ –∏–ª–∏ —Ñ–∞–π–ª—ã —è –ø–æ–∫–∞ –Ω–µ —É–º–µ—é —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ –∑–∞–º–µ—Ç–∫–∏.\n'
                                  '–î–ª—è –æ—Ç–º–µ–Ω—ã –Ω–∞–ø–∏—à–∏—Ç–µ /cancel –∏–ª–∏ /stop, –ø—Ä–æ—Å—Ç–æ "–û—Ç–º–µ–Ω–∞" —Ç–æ–∂–µ –ø–æ–¥–æ–π–¥–µ—Ç.üòä')

        # –°–Ω–æ–≤–∞ –≤—ã–∑—ã–≤–∞–µ–º —ç—Ç–æ—Ç –∂–µ —à–∞–≥, —á—Ç–æ–±—ã –±–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏–ª –∂–¥–∞—Ç—å —Ç–µ–∫—Å—Ç
        bot.register_next_step_handler(message, process_notes_step, sleep_record_id)
        # –í—ã—Ö–æ–¥–∏–º –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏, —á—Ç–æ–±—ã –∫–æ–¥ –Ω–∏–∂–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è
        return

    # –ß–∏—Å—Ç–∏–º —Ç–µ—Å—Ç –æ—Ç –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤ –∏ –ø—Ä–∏–≤–æ–¥–∏–º –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
    user_input = message.text.strip()
    user_input_lower = user_input.lower()

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—Ç–æ–ø-—Å–ª–æ–≤–∞(–∫–æ–º–∞–Ω–¥—ã)
    if user_input_lower in ['/cancel', '/stop', '–æ—Ç–º–µ–Ω–∞']:
        bot.send_message(user_id, '–î–µ–π—Å—Ç–≤–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ. –ó–∞–º–µ—Ç–∫–∞ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞.‚ùå')
        logger.info(f'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id} –æ—Ç–º–µ–Ω–∏–ª –≤–≤–æ–¥ –∑–∞–º–µ—Ç–∫–∏ —Å–ª–æ–≤–æ–º/–∫–æ–º–∞–Ω–¥–æ–π: {user_input}.')
        return

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ª—é–±—É—é –¥—Ä—É–≥—É—é –∫–æ–º–∞–Ω–¥—É
    if user_input.startswith('/'):
        bot.send_message(user_id, '–í–≤–æ–¥ –∑–∞–º–µ—Ç–∫–∏ –ø—Ä–µ—Ä–≤–∞–Ω, —Ç–∞–∫ –∫–∞–∫ –í—ã –≤–≤–µ–ª–∏ –¥—Ä—É–≥—É—é –∫–æ–º–∞–Ω–¥—É.')
        logger.info(f'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id} –ø—Ä–µ—Ä–≤–∞–ª –≤–≤–æ–¥ –∑–∞–º–µ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥–æ–π: {user_input}.')
        return

    # –ï—Å–ª–∏ –≤—Å–µ –≤ –ø–æ—Ä—è–¥–∫–µ –≤—ã–ø–æ–ª–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏
    logger.info('–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∫ –æ—Ü–µ–Ω–∫–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞.')
    try:
        # add_note() —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –ø–æ–π–º–µ—Ç, –æ–±–Ω–æ–≤–∏—Ç—å –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
        # —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç(—Å —Ä–µ–≥–∏—Å—Ç—Ä–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
        db.add_note(sleep_record_id, user_input)
        bot.send_message(user_id, "–°–ø–∞—Å–∏–±–æ, –í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∑–∞–ø–∏—Å–∞–Ω!‚úÖ")
        logger.debug('–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–π –∑–∞–ø–∏—Å–∏ –∑–∞–º–µ—Ç–∫–∏.')
    except Exception as e:
        bot.send_message(user_id, f"–ü—Ä–æ—Å—Ç–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ {e}. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.üòî")
        logger.error(f'–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏: {e}', exc_info=True)


@bot.callback_query_handler(func=lambda call: True)
def handle_callback(call: types.CallbackQuery):
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ inline –∫–Ω–æ–ø–∫–∏.
    –ö–∞–∂–¥–æ–π –∫–Ω–æ–ø–∫–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞, –¥–ª—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –µ–µ —Ñ—É–Ω–∫—Ü–∏—è-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫.
    :param call: types.CallbackQuery: –û–±—ä–µ–∫—Ç CallbackQuery, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –¥–∞–Ω–Ω—ã–µ –æ –Ω–∞–∂–∞—Ç–æ–π inline - –∫–Ω–æ–ø–∫–µ.
    """
    logger.info('–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ inline –∫–Ω–æ–ø–∫–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ '
                '(sleep, wake, quality, notes, recom, statis).')
    try:
        if call.data == '/sleep':
            handle_sleep(call.message)

        elif call.data == '/wake':
            handle_wake(call.message)

        elif call.data == '/quality':
            handle_quality(call.message)

        elif call.data == '/notes':
            handle_notes(call.message)

        elif call.data == '/recom':
            handle_recom(call.message)

        elif call.data == '/statis':
            handle_statistics(call.message)

    except Exception as e:
        bot.send_message(call.message.chat.id, f"–ü—Ä–æ—Å—Ç–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ {e}. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.üòî")
        logger.error(f'–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ inline –∫–Ω–æ–ø–∫–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–∞–Ω–¥: {e}', exc_info=True)

    # –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç–æ–≥–æ, —á—Ç–æ –∑–∞–ø—Ä–æ—Å –±—ã–ª –ø–æ–ª—É—á–µ–Ω –∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
    bot.answer_callback_query(call.id)


@bot.message_handler(func=lambda message: True)
def all_other_message(message: types.Message):
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∏–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    –ü—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–Ω–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∫ –æ—Ü–µ–Ω–∫–µ, —Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ –∏ —Ç–¥.
    :param message: types.Message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.
    """
    user_id = message.chat.id
    bot.reply_to(message, "–ü—Ä–æ—Å—Ç–∏—Ç–µ, —è –í–∞—Å –Ω–µ –ø–æ–Ω–∏–º–∞—é.üòî\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –∏–ª–∏ –∫–æ–º–∞–Ω–¥—ã.üòä")
    logger.debug('–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Å–ª—É—á–∞–µ –Ω–µ–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã—Ö –±–æ—Ç–æ–º —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.')
    logger.info(f'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ({user_id}) –æ—Ç–ø—Ä–∞–≤–∏–ª –±–æ—Ç—É –Ω–µ–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.')


def main():
    """ –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ Telegram-–±–æ—Ç–∞. """
    try:
        logger.info('Telegram-–±–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ.')
        bot.polling(non_stop=True, interval=0)
    except Exception as e:
        logger.critical(f'–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}', exc_info=True)


if __name__ == '__main__':
    main()





