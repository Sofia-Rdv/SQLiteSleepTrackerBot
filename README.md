# Telegram-–±–æ—Ç 'Sleep bot'

## –û–±–∑–æ—Ä
–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π Telegram-–±–æ—Ç–∞ –Ω–∞ —è–∑—ã–∫–µ Python (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ telebot), –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö SQLite.
–ë–æ—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ü–∏–∫–ª–æ–≤ —Å–Ω–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å–Ω–∞, –æ—Ü–µ–Ω–∏–≤–∞—Ç—å –µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–æ –∏ –¥–æ–±–∞–≤–ª—è—Ç—å –∑–∞–º–µ—Ç–∫–∏.

–í –ø—Ä–æ–µ–∫—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –Ω–∞–¥–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ CRUD-–æ–ø–µ—Ä–∞—Ü–∏–π, –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏.


## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏.
- **–¢—Ä–µ–∫–∏–Ω–≥ —Å–Ω–∞:** –ó–∞–ø–∏—Å—å –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç—Ö–æ–¥–∞ –∫–æ —Å–Ω—É –∏ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è.
- **–û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞:** –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É –∫–∞–∂–¥–æ–π —Å–µ—Å—Å–∏–∏ —Å–Ω–∞.
- **–ó–∞–º–µ—Ç–∫–∏:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫ –∑–∞–ø–∏—Å—è–º –æ —Å–Ω–µ.
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –¥–µ–±–∞–≥–≥–∏–Ω–≥–∞.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
SleepBotProject/
‚îú‚îÄ‚îÄ sleep_bot.py                # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ —Ö–µ–Ω–¥–ª–µ—Ä—ã –±–æ—Ç–∞
‚îú‚îÄ‚îÄ database_manager.py         # –õ–æ–≥–∏–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ë–î (CRUD)
‚îú‚îÄ‚îÄ sleep_tracker.db            # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite
‚îú‚îÄ‚îÄ test_database_manager.py    # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ë–î
‚îú‚îÄ‚îÄ test_sleep_bot.py           # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π –±–æ—Ç–∞
‚îú‚îÄ‚îÄ my_logger_config.py         # –ú–æ–¥—É–ª—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –ª–æ–≥–≥–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ my_logging_config.yaml      # YAML-—Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ my_color_formatter.py       # –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä –¥–ª—è —Ü–≤–µ—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ –ª–æ–≥–æ–≤ –≤ –∫–æ–Ω—Å–æ–ª—å
‚îî‚îÄ‚îÄ logs/                       # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å —Ñ–∞–π–ª–∞–º–∏ –ª–æ–≥–æ–≤
    ‚îú‚îÄ‚îÄ app.log                 # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    ‚îî‚îÄ‚îÄ error.log               # –õ–æ–≥–∏ –æ—à–∏–±–æ–∫ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö SQLite `sleep_tracker.db`, —Å–æ–¥–µ—Ä–∂–∞—â–µ–π —Ç—Ä–∏ —Ç–∞–±–ª–∏—Ü—ã `users`, `sleep_records`, `notes`.

–¢–∞–±–ª–∏—Ü–∞ `users` –∏–º–µ–µ—Ç —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
```
|  –ö–æ–ª–æ–Ω–∫–∞  | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | –û–ø–∏—Å–∞–Ω–∏–µ
|:----------|:-----------|:------------------------------------
| `id`      | INTEGER    | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (PRIMARY KEY, AUTOINCREMENT)
| `name`    | TEXT       | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (NOT NULL)
```

–¢–∞–±–ª–∏—Ü–∞ `sleep_records` –∏–º–µ–µ—Ç —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```
|    –ö–æ–ª–æ–Ω–∫–∞     | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | –û–ø–∏—Å–∞–Ω–∏–µ
|:---------------|:-----------|:------------------------------------
| `id`           | INTEGER    | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–µ—Å—Å–∏–∏ —Å–Ω–∞(PRIMARY KEY, AUTOINCREMENT)
| `user_id`      | INTEGER    | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (FOREIGN KEY, NOT NULL)
| `sleep_time`   | DATETIME   | –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Å–Ω–∞
| `wake_time`    | DATETIME   | –í—Ä–µ–º—è –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è
| `sleep_quality`| INTEGER    | –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞
```

–¢–∞–±–ª–∏—Ü–∞ `notes` –∏–º–µ–µ—Ç —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
```
|    –ö–æ–ª–æ–Ω–∫–∞       | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | –û–ø–∏—Å–∞–Ω–∏–µ
|:-----------------|:-----------|:------------------------------------
| `id`             | INTEGER    | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–µ—Å—Å–∏–∏ —Å–Ω–∞(PRIMARY KEY, AUTOINCREMENT)
| `notes_text`     | TEXT       | –¢–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏(–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è) –∫ –æ—Ü–µ–Ω–∫–µ –∫–∞—á–µ—Å—Ç–≤–∞
| `sleep_record_id`| DATETIME   | ID —Å–µ—Å—Å–∏–∏ —Å–Ω–∞ (FOREIGN KEY, NOT NULL UNIQUE)
```

---

## –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- `Python 3.10+`
- `telebot` (–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Telegram-–±–æ—Ç–∞)
- `sqlite3` (–≤—Å—Ç—Ä–æ–µ–Ω –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É Python)
- `pytest` (–¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤)
- `PyYAML` (–¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
- `Colorama` - (–¥–ª—è —Ü–≤–µ—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ –ª–æ–≥–æ–≤ –≤ –∫–æ–Ω—Å–æ–ª—å)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞
1. **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
```
git clone <URL_–†–ï–ü–û–ó–ò–¢–û–†–ò–Ø>
cd <–ò–ú–Ø_–ü–ê–ü–ö–ò_–ü–†–û–ï–ö–¢–ê>
```
2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏** (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é —Å–º. –Ω–∏–∂–µ).
3. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
```
python sleep_bot.py
```

### –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –±–∏–±–ª–∏–æ—Ç–µ–∫

1. –í –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –∏–ª–∏ –æ–∫–Ω–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –≤–≤–µ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—É
2. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É Enter

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏

- `pip install PyYAML`             - –î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ PyYAML
- `pip install colorama`           - –î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Colorama
- `pip install pytest`             - –î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ PyTest
- `pip install pyTelegramBotAPI`   - –î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ telebot
---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –¥–æ—Å—Ç—É–ø–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start` –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É **'–°–ª–∞–¥–∫–∏—Ö —Å–Ω–æ–≤ üò¥'** –∏–ª–∏ –∫–æ–º–∞–Ω–¥—É `/sleep`, —á—Ç–æ–±—ã –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Å–Ω–∞.
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **'–Ø –ø—Ä–æ—Å–Ω—É–ª—Å—è ‚òÄ'** –∏–ª–∏ –∫–æ–º–∞–Ω–¥—É `/wake`, —á—Ç–æ–±—ã –∑–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ—Å—Å–∏—é —Å–Ω–∞.
4. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **'–ö–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞ üí´'** –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –∫–∞—á–µ—Å—Ç–≤–∞ (1-5) –Ω–∞ –ø–æ—è–≤–∏–≤—à–µ–π—Å—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ.
5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É **'–ó–∞–º–µ—Ç–∫–∏ üìù'** –∏–ª–∏ –∫–æ–º–∞–Ω–¥—É `/notes`, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –æ—Ü–µ–Ω–∫–µ —Å–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, '–°–ø–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ').

---
## –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä–∞—è:

- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è(–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î) –∏ –æ—à–∏–±–∫–∏.
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (INFO, WARNING, ERROR, DEBUG, CRITICAL).
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ü–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏.
- –•—Ä–∞–Ω–∏—Ç –ª–æ–≥–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö(app.log –¥–ª—è –æ–±—â–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, error.log –¥–ª—è –æ—à–∏–±–æ–∫) –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `logs/`.

### –§–∞–π–ª—ã –ª–æ–≥–æ–≤

- **app.log**: –°–æ–¥–µ—Ä–∂–∏—Ç –æ–±—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–∞–±–æ—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –≤–∫–ª—é—á–∞—è –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —É—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è.
- **error.log**: –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è `ERROR` –∏ –≤—ã—à–µ, –≤–∫–ª—é—á–∞—è –æ—à–∏–±–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î, –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–±–æ–∏.

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ 
—Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã:
- **my_logger_config.py**: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- **my_logging_config.yaml**: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ª–æ–≥–≥–µ—Ä–æ–≤
- **my_color_formatter.py**: –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä –¥–ª—è —Ü–≤–µ—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ –≤ –∫–æ–Ω—Å–æ–ª—å

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è **–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**. –í–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç—ã—Ö unit-—Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è —Ü–µ–ª—ã–µ —Ü–µ–ø–æ—á–∫–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è.

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤:**
- **–ò–∑–æ–ª—è—Ü–∏—è:** –ö–∞–∂–¥–æ–º—É —Ç–µ—Å—Ç—É —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ñ–∞–π–ª–æ–≤–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö(—á–µ—Ä–µ–∑ —Ñ–∏–∫—Å—Ç—É—Ä—É pytest), —á—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —á–∏—Å—Ç–æ—Ç—É –¥–∞–Ω–Ω—ã—Ö.
- **–ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ (unittest.mock):** 
  * **Telegram API:** –ò–º–∏—Ç–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç —Å–µ—Ä–≤–µ—Ä–æ–≤ Telegram, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.
  * **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `patch` –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ —Å–±–æ–µ–≤ –≤ —Ä–∞–±–æ—Ç–µ `SQLite`. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π (–±–ª–æ–∫–∏ try...except) –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏ –ª–æ–≥–æ–≤ –æ—à–∏–±–æ–∫ –≤ —Ñ–∞–π–ª `error.log`.

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

–¢–µ—Å—Ç—ã –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–∑ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏:
- `pytest` - –ö—Ä–∞—Ç–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `pytest -v` - –ë–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–¢–∞–∫–∂–µ —Ñ–∞–π–ª —Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–∫ –∏ –æ–±—ã—á–Ω—ã–π –∫–æ–¥, —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É `run`.

### –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

#### 1. –¢–µ—Å—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

```python
import pytest
import sqlite3
from database_manager import DatabaseManager

def test_add_user_successfully(db_manager: DatabaseManager, caplog: pytest.LogCaptureFixture):
    """
    –¢–µ—Å—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –º–µ—Ç–æ–¥ add_user —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ ID –∏ –∏–º–µ–Ω–µ–º.

    –û–∂–∏–¥–∞–µ—Ç—Å—è, —á—Ç–æ add_user –∑–∞–ø–∏—à–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –º–µ—Ç–æ–¥–∞ –≤ –ª–æ–≥.
    :param db_manager: DatabaseManager: –ú–µ–Ω–µ–¥–∂–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–π —Ñ–∏–∫—Å—Ç—É—Ä–æ–π.
    :param caplog: pytest.LogCaptureFixture: –§–∏–∫—Å—Ç—É—Ä–∞ pytest –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –ª–æ–≥–≥–µ—Ä–∞.
    """
    user_id = 1
    user_name = 'TestUser'
    db_manager.add_user(user_id, user_name)

    with sqlite3.connect(db_manager.db_name) as conn:
        cursor = conn.cursor()
        cursor.execute("SELECT id, name FROM users WHERE id = ?", (user_id,))
        user = cursor.fetchone()
    conn.close()

    assert user == (user_id, user_name)
    expected_log_message = f'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_name} ({user_id}) –¥–æ–±–∞–≤–ª–µ–Ω –∏–ª–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î {db_manager.db_name}.'
    assert expected_log_message in caplog.text
```

#### 2. –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ç–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–∏-—Ä–æ—É—Ç–µ—Ä–∞ –±–æ—Ç–∞ (–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ inline –∫–Ω–æ–ø–∫–∏.)
```python
import pytest
from unittest.mock import MagicMock, patch

with patch('telebot.TeleBot') as mocked_bot_class:
    mock_bot_instance = MagicMock()
    mock_bot_instance.message_handler.return_value = lambda func: func
    mock_bot_instance.callback_query_handler.return_value = lambda func: func

    mocked_bot_class.return_value = mock_bot_instance
    import sleep_bot

from pytest_mock import MockFixture

@pytest.mark.parametrize('command_to_test, handler_name', [
    ('/sleep', 'handle_sleep'),
    ('/wake', 'handle_wake'),
    ('/quality', 'handle_quality'),
    ('/notes', 'handle_notes'),
    ('/recom', 'handle_recom'),
    ('/statis', 'handle_statistics')
])
def test_handle_callback_routing(test_db, mocker: MockFixture, command_to_test: str, handler_name: str) -> None:
    """
    –¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Ä–æ—É—Ç–∏–Ω–≥: —á—Ç–æ –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ inline –∫–Ω–æ–ø–∫—É –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫.
    :param test_db: –§–∏–∫—Å—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
    :param mocker: MockFixture: –û–±—ä–µ–∫—Ç –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏ (mocking).
    :param command_to_test: –ö–ª—é—á –∫ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–π –∫–æ–º–∞–Ω–¥–µ.
    :param handler_name: –ö–ª—é—á –∫ –∏–º–µ–Ω–∏ —Ö–µ–Ω–¥–ª–µ—Ä–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–π –∫–æ–º–∞–Ω–¥—ã.
    """
    call = MagicMock()
    call.id = 'test_id'
    call.data = command_to_test
    call.message.chat.id = 123

    mocked_handler = mocker.patch(f'sleep_bot.{handler_name}')

    sleep_bot.bot.answer_callback_query.reset_mock()
    sleep_bot.handle_callback(call)
    
    mocked_handler.assert_called_once_with(call.message)
    sleep_bot.bot.answer_callback_query.assert_called_once_with(call.id)
```